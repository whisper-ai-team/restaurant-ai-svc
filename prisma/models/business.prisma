model Business {

  id              String         @id @default(uuid())
  name            String
  metaBusinessId  String?        @unique
  configurationId String?        @unique
  redirectUri     String?
  status          BusinessStatus @default(PENDING)
  notes           String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  metaDetails   BusinessMetaDetail?
  credentials   BusinessCredential?
  competitors   BusinessCompetitor[]
  socialReviews BusinessSocialReview[]

  // ðŸ”¹ Back-relations
  campaigns Campaign[]            @relation("BusinessCampaigns")
  events    Event[]               @relation("BusinessEvents")
  metrics   DailyBusinessMetric[] @relation("BusinessMetrics")

  @@index([status])
  @@index([name])
  @@schema("business")
}

model BusinessMetaDetail {

  id            String   @id @default(uuid())
  businessId    String   @unique
  legalName     String?
  primaryPageId String?
  timezone      String?
  currency      String?
  website       String?
  industry      String?
  address       String?
  city          String?
  state         String?
  country       String?
  postalCode    String?
  phoneNumber   String?
  supportEmail  String?
  updatedAt     DateTime @updatedAt
  createdAt     DateTime @default(now())

  business Business @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@schema("business")
}

model BusinessCompetitor {

  id              String   @id @default(uuid())
  businessId      String
  name            String
  facebookPageId  String?
  instagramHandle String?
  website         String?
  notes           String?
  addedBy         String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  business Business @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@index([businessId])
  @@index([name])
  @@schema("business")
}

model BusinessCredential {

  id              String    @id @default(uuid())
  businessId      String    @unique
  systemUserToken String
  tokenType       String    @default("SYSTEM_USER")
  expiresAt       DateTime?
  grantedScopes   String[]
  connectedAssets Json?
  metaBusinessId  String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  business Business @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@schema("business")
}

model BusinessSocialReview {

  id           String           @id @default(uuid())
  businessId   String
  platform     SocialPlatform
  reviewId     String?
  reviewerName String?
  rating       Int?
  comment      String?
  permalink    String?
  postedAt     DateTime?
  sentiment    ReviewSentiment?
  metadata     Json?
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt

  business Business @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@index([businessId])
  @@index([platform])
  @@index([sentiment])
  @@index([postedAt])
  @@schema("business")
}
